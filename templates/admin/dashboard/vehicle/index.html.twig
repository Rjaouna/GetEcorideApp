{# templates/vehicle/index.html.twig #}
{% extends 'template.html.twig' %}

{% block title %}Vehicles
{% endblock %}

{# CSS DataTables #}
{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('dashboard/vendor/datatables/dataTables.bootstrap4.min.css') }}" rel="stylesheet">
{% endblock %}

{% block body %}
<div class="card shadow mb-4">
	<div class="card-header py-3 d-flex justify-content-between align-items-center">
		<h6 class="m-0 font-weight-bold text-primary">
Liste des véhicules
		</h6>
	</div>
	<div class="card-body">


			<div class="table-responsive">
				<table class="table table-bordered" id="dataTableVehicles" width="100%" cellspacing="0">
					<thead>
						<tr>
							<th>Immat.</th>
							<th>Marque</th>
							<th>Modèle</th>
							<th>Sièges</th>
							<th>Électrique</th>
							<th>Actif</th>
							<th>Propriétaire</th>
							<th>1ère mise en circ.</th>
							<th>Créé</th>
							<th>MAJ</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tfoot>
						<tr>
							<th>Immat.</th>
							<th>Marque</th>
							<th>Modèle</th>
							<th>Sièges</th>
							<th>Électrique</th>
							<th>Actif</th>
							<th>Propriétaire</th>
							<th>1ère mise en circ.</th>
							<th>Créé</th>
							<th>MAJ</th>
							<th>Actions</th>
						</tr>
					</tfoot>
					<tbody>
						{% for vehicle in vehicles %}
							{% set firstReg = vehicle.firstRegistrationAt ?? vehicle.firstRegistraionAt ?? null %}
							<tr>
								<td>
									<span class="font-weight-bold">{{ vehicle.plateNumber }}</span>
								</td>
								<td>{{ vehicle.brand }}</td>
								<td>{{ vehicle.model }}</td>
								<td class="text-center">{{ vehicle.seats }}</td>
								<td class="text-center">
									{% if vehicle.isElectric %}
										<span class="badge badge-success">Oui</span>
									{% else %}
										<span class="badge badge-secondary">Non</span>
									{% endif %}
								</td>
								<td class="text-center">
									{% if vehicle.isActive %}
										<span class="badge badge-primary">Actif</span>
									{% else %}
										<span class="badge badge-light">Inactif</span>
									{% endif %}
								</td>
								<td>
									{% if vehicle.owner is defined and vehicle.owner %}
										{{ vehicle.owner.pseudo ?? vehicle.owner.email }}
									{% else %}
										—
									{% endif %}
								</td>
								<td>{{ firstReg ? firstReg|date('Y-m-d') : '—' }}</td>
								<td>{{ vehicle.createdAt ? vehicle.createdAt|date('Y-m-d H:i') : '—' }}</td>
								<td>{{ vehicle.updatedAt ? vehicle.updatedAt|date('Y-m-d H:i') : '—' }}</td>
								<td class="text-nowrap">
									<a href="{{ path('app_vehicle_show', {'id': vehicle.id}) }}" class="btn btn-sm btn-info">
										<i class="fas fa-eye"></i>
									</a>
									<a href="{{ path('app_vehicle_edit', {'id': vehicle.id}) }}" class="btn btn-sm btn-warning">
										<i class="fas fa-edit"></i>
									</a>
								</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="11" class="text-center text-muted">Aucun véhicule trouvé</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
</div></div>
</div>



{% endblock %}

{% block javascripts %}
	{{ parent() }}
	 <script>
	    function initVehiclesDT() {
	      if (!$.fn.DataTable.isDataTable('#dataTableVehicles')) {
	        $('#dataTableVehicles').DataTable({
	          dom: 'lfrtip',          // inclut la barre de recherche + pagination
	          pageLength: 10,
	          lengthMenu: [10, 25, 50, 100],
	          order: [[0, 'asc']],
	        });
	      }
	    }
	    document.addEventListener('DOMContentLoaded', initVehiclesDT);
	    document.addEventListener('turbo:load', initVehiclesDT);
	  </script>
{% endblock %}



