{% extends 'template.html.twig' %}

{% block title %}User index
{% endblock %}

{# CSS DataTables #}
{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('dashboard/vendor/datatables/dataTables.bootstrap4.min.css') }}" rel="stylesheet">
{% endblock %}

{% block body %}
	<div class="card shadow mb-4">
		<div class="card-header py-3 d-flex justify-content-between align-items-center">
			<h6 class="m-0 font-weight-bold text-primary">Liste utilisateurs</h6>
		</div>

		<div class="card-body">
			<table id="usersTable" class="table table-striped table-hover align-middle">
				<thead>
					<tr>
						<th>ID</th>
						<th>Pseudo</th>
						<th>Nom complet</th>
						<th>Adresse email</th>
						<th>Téléphone</th>
						<th>Adresse postale</th>
						<th>Créé le</th>
						{# <-- ajouté pour matcher le tbody #}
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
						{% set createdEpoch = user.createdAt ? user.createdAt|date('U') : '' %}
						<tr>
							<td>{{ user.id }}</td>
							<td>{{ user.pseudo }}</td>
							<td>{{ user.firstName }}
								{{ user.lastName }}</td>
							<td>{{ user.email }}</td>
							<td>{{ user.phone }}</td>
							<td>{{ user.address }}</td>
							<td data-order="{{ createdEpoch }}">
								{{ user.createdAt ? user.createdAt|date('d/m/Y H:i') : '' }}
							</td>
							<td class="text-nowrap">
								<a class="btn btn-sm btn-outline-primary" href="{{ path('app_user_show', {'id': user.id}) }}">Voir</a>
							</td>
						</tr>
					{% else %}
						<tr>
							<td colspan="8">Aucun utilisateur créé</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
{% endblock %}

{# JS nécessaires + init une seule fois #}
{% block javascripts %}
	{{ parent() }}
{# jQuery & Bootstrap (adapte les chemins à tes assets) #}
	 <script src="{{ asset('dashboard/vendor/jquery/jquery.min.js') }}"></script>
	 <script src="{{ asset('dashboard/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

	{# DataTables jQuery + intégration Bootstrap 4 #}
	 <script src="{{ asset('dashboard/vendor/datatables/jquery.dataTables.min.js') }}"></script>
	 <script src="{{ asset('dashboard/vendor/datatables/dataTables.bootstrap4.min.js') }}"></script>

	 <script>
	    function initUsersDT() {
	      if ($.fn.DataTable.isDataTable('#usersTable')) return;
	
	      $('#usersTable').DataTable({
	        responsive: true,
	        pageLength: 10,
	        lengthMenu: [[10, 25, 50, -1], [10, 25, 50, 'Tous']],
	        order: [[0, 'asc']], // tri par ID
	        language: {
	          processing:     "Traitement en cours...",
	          search:         "Rechercher&nbsp;:",
	          lengthMenu:     "Afficher _MENU_ entrées",
	          info:           "Affichage de _START_ à _END_ sur _TOTAL_ entrées",
	          infoEmpty:      "Affichage de 0 à 0 sur 0 entrée",
	          infoFiltered:   "(filtré de _MAX_ entrées au total)",
	          loadingRecords: "Chargement...",
	          zeroRecords:    "Aucune entrée correspondante trouvée",
	          emptyTable:     "Aucune donnée disponible dans le tableau",
	          paginate: {
	            first: "Premier", previous: "Précédent", next: "Suivant", last: "Dernier"
	          },
	          aria: {
	            sortAscending:  ": activer pour trier la colonne par ordre croissant",
	            sortDescending: ": activer pour trier la colonne par ordre décroissant"
	          }
	        },
	        columnDefs: [
	          { targets: -1, orderable: false, searchable: false } // Actions non triables/recherchables
	        ]
	      });
	    }
	
	    document.addEventListener('DOMContentLoaded', initUsersDT);
	    document.addEventListener('turbo:load', initUsersDT); // si tu utilises Turbo
	  </script>
{% endblock %}

