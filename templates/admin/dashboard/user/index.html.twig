{% extends 'template.html.twig' %}

{% block title %}User index
{% endblock %}
{# CSS DataTables #}
{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('dashboard/vendor/datatables/dataTables.bootstrap4.min.css') }}" rel="stylesheet">
{% endblock %}

{% block body %}
<div class="card shadow mb-4">
	<div class="card-header py-3 d-flex justify-content-between align-items-center">
		<h6 class="m-0 font-weight-bold text-primary">
			Liste utilisateus
		</h6>
	</div>
	<div class="card-body">


	<table id="usersTable" class="table table-striped table-hover align-middle">
		<thead>
			<tr>
				<th>Id</th>
				<th>Email</th>
				<th>FirstName</th>
				<th>LastName</th>
				<th>Phone</th>
				<th>Address</th>
				<th>DateOfBirth</th>
				<th>Pseudo</th>
				<th>CreatedAt</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			{% for user in users %}
				{% set dobEpoch = user.dateOfBirth ? user.dateOfBirth|date('U') : '' %}
				{% set createdEpoch = user.createdAt ? user.createdAt|date('U') : '' %}

				<tr>
					<td>{{ user.id }}</td>
					<td>{{ user.email }}</td>
					<td>{{ user.firstName }}</td>
					<td>{{ user.lastName }}</td>
					<td>{{ user.phone }}</td>
					<td>{{ user.address }}</td>

					{# Affichage lisible + tri parfait #}
					<td data-order="{{ dobEpoch }}">
						{{ user.dateOfBirth ? user.dateOfBirth|date('d/m/Y') : '' }}
					</td>
					<td>{{ user.pseudo }}</td>
					<td data-order="{{ createdEpoch }}">
						{{ user.createdAt ? user.createdAt|date('d/m/Y H:i') : '' }}
					</td>
					<td class="text-nowrap">
						<a class="btn btn-sm btn-outline-primary" href="{{ path('app_user_show', {'id': user.id}) }}">show</a>
						<a class="btn btn-sm btn-primary" href="{{ path('app_user_edit', {'id': user.id}) }}">edit</a>
					</td>
				</tr>
			{% else %}
				<tr>
					<td colspan="10">no records found</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>

	<a class="btn btn-success" href="{{ path('app_user_new') }}">Create new</a>
</div>
	{# Init DataTables juste pour cette page #}
	 <script>
	        document.addEventListener('DOMContentLoaded', function () {
	            const table = new DataTable('#usersTable', {
	                responsive: true,
	                pageLength: 10,
	                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, 'Tous']],
	                order: [[0, 'asc']], // tri par ID au chargement
	                language: {
	                    processing:     "Traitement en cours...",
	                    search:         "Rechercher&nbsp;:",
	                    lengthMenu:     "Afficher _MENU_ entrées",
	                    info:           "Affichage de _START_ à _END_ sur _TOTAL_ entrées",
	                    infoEmpty:      "Affichage de 0 à 0 sur 0 entrée",
	                    infoFiltered:   "(filtré de _MAX_ entrées au total)",
	                    loadingRecords: "Chargement...",
	                    zeroRecords:    "Aucune entrée correspondante trouvée",
	                    emptyTable:     "Aucune donnée disponible dans le tableau",
	                    paginate: {
	                        first:      "Premier",
	                        previous:   "Précédent",
	                        next:       "Suivant",
	                        last:       "Dernier"
	                    },
	                    aria: {
	                        sortAscending:  ": activer pour trier la colonne par ordre croissant",
	                        sortDescending: ": activer pour trier la colonne par ordre décroissant"
	                    }
	                },
	                columnDefs: [
	                    // Empêche le tri sur la colonne Actions
	                    { targets: -1, orderable: false, searchable: false }
	                ],
	                // Si tu veux les boutons d’export, décommente le bloc ci-dessous
	                // dom: 'Bfrtip',
	                // buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
	            });
	        });
	    </script>
{% endblock %}
{% block javascripts %}
	{{ parent() }}
	 <script>
		    function initVehiclesDT() {
if (!$.fn.DataTable.isDataTable('#usersTable')) {

$('#usersTable').DataTable({

		          dom: 'lfrtip',          // inclut la barre de recherche + pagination
		          pageLength: 10,
		          lengthMenu: [10, 25, 50, 100],
		          order: [[0, 'asc']],
		        });
		      }
		    }
		    document.addEventListener('DOMContentLoaded', initVehiclesDT);
		    document.addEventListener('turbo:load', initVehiclesDT);
		  </script>
{% endblock %}

