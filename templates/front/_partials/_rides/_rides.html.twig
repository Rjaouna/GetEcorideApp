<div class="container my-4">
	<h2 class="mb-3">Trajets dÃ©part de votre ville</h2>
	<div class="row" id="rides-container"></div>
</div>

 <script>
  async function getRides() {
    const response = await fetch('https://127.0.0.1:8000/api/carpoolings');
    const data = await response.json();
    return Array.isArray(data) ? data : (data['hydra:member'] ?? []);
  }

  function formatDate(dateStr) {
    if (!dateStr) return '';
    return new Date(dateStr).toLocaleString('fr-FR', {
      day: '2-digit',
      month: 'short',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  // ðŸŸ¢ base URL gÃ©nÃ©rÃ©e par Symfony
const baseUrl = "{{ path('app_front_carpooling', { id: '__ID__' }) }}";


  getRides().then(rides => {
    const listRides = document.getElementById('rides-container');

    rides.slice(0, 3).forEach(ride => {
      const col = document.createElement('div');
      col.className = 'col-md-4 mb-4';

      const driverFirstName = ride.driver?.firstName ?? 'Conducteur';
      const driverLastName  = ride.driver?.lastName ?? '';
      const ecoBadge = ride.ecoTag ? `<span class="badge bg-success ms-2">ðŸŒ± Ã‰co</span>` : '';

      // âœ… lien dynamique remplacÃ© dans le JS
      const detailUrl = baseUrl.replace('__ID__', ride.id);

      col.innerHTML = `
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="card-title mb-0">${driverFirstName} ${driverLastName}</h5>
              ${ecoBadge}
            </div>
            <p class="text-muted mb-2">
              ðŸš— ${ride.deparatureCity} â†’ <strong>${ride.arrivalCity}</strong>
            </p>
            <p class="mb-3">
              ðŸ“… DÃ©part : <strong>${formatDate(ride.deparatureAt)}</strong>
            </p>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="badge bg-light">
                Places : ${ride.seatsAvaible ?? ride.seatsTotal ?? 'â€”'}
              </span>
              <a href="${detailUrl}" class="btn btn-primary btn-sm">
                DÃ©tails
              </a>
            </div>
          </div>
        </div>
      `;

      listRides.appendChild(col);
    });
  });
</script>

